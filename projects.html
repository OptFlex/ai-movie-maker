<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼ç”»ä¸€è¦§ - AI Movie Maker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app" class="min-h-screen flex flex-col">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="bg-white border-b border-gray-200 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <a href="./index.html" class="text-gray-600 hover:text-gray-900 transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                    </a>
                    <div class="text-3xl">ğŸ“‹</div>
                    <h1 class="text-2xl font-bold text-gray-900">çµµã‚³ãƒ³ãƒ†ä¼ç”»ä¸€è¦§</h1>
                </div>
                <div class="flex items-center gap-4">
                    <span id="user-email" class="text-sm text-gray-600">user@example.com</span>
                    <button id="logout-btn" class="text-sm text-red-600 hover:text-red-700 font-medium transition">
                        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </div>
            </div>
        </header>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="flex-1 max-w-7xl mx-auto px-4 py-8 w-full">
            <!-- æ–°è¦ä¼ç”»ä½œæˆãƒœã‚¿ãƒ³ -->
            <div class="mb-8">
                <button id="create-project-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold flex items-center gap-2 shadow-md hover:shadow-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    æ–°è¦ä¼ç”»ä½œæˆ
                </button>
            </div>

            <!-- ä¼ç”»ä¸€è¦§ -->
            <div id="projects-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>

            <!-- ä¼ç”»ãŒãªã„å ´åˆã®è¡¨ç¤º -->
            <div id="empty-state" class="hidden text-center py-20">
                <div class="text-6xl mb-4">ğŸ“‹</div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">ä¼ç”»ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</h3>
                <p class="text-gray-600 mb-6">ã€Œæ–°è¦ä¼ç”»ä½œæˆã€ãƒœã‚¿ãƒ³ã‹ã‚‰æœ€åˆã®ä¼ç”»ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†</p>
            </div>
        </main>
    </div>

    <script>
        // Supabaseè¨­å®š
        const SUPABASE_URL = 'https://sdrpysyhoqnrpixwnhfy.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNkcnB5c3lob3FucnBpeHduaGZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2ODYwMDMsImV4cCI6MjA4MzI2MjAwM30.UK9f1aP_49c49KlIHRekvb3nmK5pInR3kMW-mwILzkI'

        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        // èªè¨¼ãƒã‚§ãƒƒã‚¯
        async function checkAuth() {
            const { data: { session } } = await supabaseClient.auth.getSession()

            if (!session) {
                // æœªãƒ­ã‚°ã‚¤ãƒ³ãªã‚‰login.htmlã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                window.location.href = './login.html'
                return
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
        checkAuth()

        // ========================================
        // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆSupabaseã®projectsãƒ†ãƒ¼ãƒ–ãƒ«ã¨åŒã˜æ§‹é€ ï¼‰
        // ========================================
        const mockProjects = [
            {
                id: 1,
                title: "YouTubeå‹•ç”»ä¼ç”» #1",
                channel_name: "Techè§£èª¬ãƒãƒ£ãƒ³ãƒãƒ«",
                thumbnail_url: null,  // å¾Œã§ç”»åƒURLãŒå…¥ã‚‹
                thumbnail_emoji: "ğŸ“‹",
                thumbnail_gradient: "from-blue-400 to-purple-500",
                created_at: "2026-01-03T10:00:00",
                updated_at: "2026-01-03T15:30:00",
                user_id: "user123"
            },
            {
                id: 2,
                title: "è£½å“ç´¹ä»‹å‹•ç”»ä¼ç”»",
                channel_name: "ãƒ“ã‚¸ãƒã‚¹ãƒãƒ£ãƒ³ãƒãƒ«",
                thumbnail_url: null,
                thumbnail_emoji: "ğŸ¬",
                thumbnail_gradient: "from-green-400 to-blue-500",
                created_at: "2026-01-02T09:00:00",
                updated_at: "2026-01-02T14:20:00",
                user_id: "user123"
            },
            {
                id: 3,
                title: "ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å‹•ç”»",
                channel_name: "Techè§£èª¬ãƒãƒ£ãƒ³ãƒãƒ«",
                thumbnail_url: null,
                thumbnail_emoji: "ğŸ“º",
                thumbnail_gradient: "from-orange-400 to-pink-500",
                created_at: "2026-01-01T11:00:00",
                updated_at: "2026-01-01T16:45:00",
                user_id: "user123"
            },
            {
                id: 4,
                title: "å•†å“ãƒ¬ãƒ“ãƒ¥ãƒ¼å‹•ç”»",
                channel_name: "ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒ£ãƒ³ãƒãƒ«",
                thumbnail_url: null,
                thumbnail_emoji: "ğŸ¥",
                thumbnail_gradient: "from-purple-400 to-indigo-500",
                created_at: "2025-12-31T13:00:00",
                updated_at: "2025-12-31T18:15:00",
                user_id: "user123"
            }
        ];

        // ========================================
        // ãƒ‡ãƒ¼ã‚¿å–å¾—é–¢æ•°ï¼ˆå¾Œã§Supabaseã«ç½®ãæ›ãˆï¼‰
        // ========================================
        async function loadProjects() {
            // TODO: Supabaseæ¥ç¶šæ™‚ã¯ä»¥ä¸‹ã«ç½®ãæ›ãˆ
            // const { data, error } = await supabase
            //     .from('projects')
            //     .select('*')
            //     .order('updated_at', { ascending: false });
            // if (error) throw error;
            // return data;

            // ç¾åœ¨ã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
            return mockProjects;
        }

        // ========================================
        // æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
        // ========================================
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}/${month}/${day}`;
        }

        // ========================================
        // ä¼ç”»ä¸€è¦§ã‚’æç”»
        // ========================================
        function renderProjects(projects) {
            const listDiv = document.getElementById('projects-list');
            const emptyState = document.getElementById('empty-state');

            if (projects.length === 0) {
                listDiv.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            listDiv.classList.remove('hidden');
            emptyState.classList.add('hidden');

            // ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‹•çš„ã«HTMLã‚’ç”Ÿæˆ
            const html = projects.map(project => `
                <div class="cursor-pointer group bg-white border-2 border-gray-200 rounded-xl p-3 shadow-md hover:shadow-xl hover:border-blue-400 transition-all"
                     onclick="openProject(${project.id})">
                    <!-- ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒ -->
                    <div class="aspect-video bg-gradient-to-br ${project.thumbnail_gradient} rounded-lg mb-3 flex items-center justify-center text-white text-4xl overflow-hidden">
                        ${project.thumbnail_emoji}
                    </div>
                    <!-- ã‚¿ã‚¤ãƒˆãƒ«ãƒ»æƒ…å ± -->
                    <div>
                        <h3 class="font-semibold text-gray-900 group-hover:text-blue-600 transition line-clamp-2 text-sm mb-2">
                            ${project.title}
                        </h3>
                        <p class="text-xs text-gray-600">${project.channel_name}</p>
                        <p class="text-xs text-gray-500">${formatDate(project.updated_at)} æ›´æ–°</p>
                    </div>
                </div>
            `).join('');

            listDiv.innerHTML = html;
        }

        // ========================================
        // ä¼ç”»ã‚’é–‹ã
        // ========================================
        function openProject(projectId) {
            console.log('ä¼ç”»ã‚’é–‹ã: ID =', projectId);
            window.location.href = `./storyboard.html?project=${projectId}`;
        }

        // ========================================
        // åˆæœŸåŒ–å‡¦ç†
        // ========================================
        async function init() {
            // TODO: èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’ã“ã“ã«è¿½åŠ ï¼ˆå¾Œã§å®Ÿè£…ï¼‰
            document.getElementById('app').style.display = 'flex';

            // ä¼ç”»ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤º
            try {
                const projects = await loadProjects();
                renderProjects(projects);
            } catch (error) {
                console.error('ä¼ç”»ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
                alert('ä¼ç”»ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ========================================
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        // ========================================

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³
        document.getElementById('logout-btn').addEventListener('click', () => {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                window.location.href = './login.html';
            }
        });

        // æ–°è¦ä¼ç”»ä½œæˆ
        document.getElementById('create-project-btn').addEventListener('click', () => {
            // TODO: å¾Œã§Supabaseã§æ–°è¦ä¼ç”»ä½œæˆ
            // ç¾åœ¨ã¯ç›´æ¥storyboard.htmlã¸ï¼ˆæ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰ï¼‰
            window.location.href = './storyboard.html';
        });

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
