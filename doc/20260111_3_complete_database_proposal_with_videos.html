<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çµµã‚³ãƒ³ãƒ†ã‚¢ãƒ—ãƒª - å®Œå…¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆææ¡ˆï¼ˆå‹•ç”»ãƒ†ãƒ¼ãƒ–ãƒ«å«ã‚€ï¼‰</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 0;
      line-height: 1.6;
    }

    .header {
      background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
      color: white;
      padding: 60px 40px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    .header h1 {
      font-size: 3rem;
      margin-bottom: 15px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header .subtitle {
      font-size: 1.3rem;
      opacity: 0.95;
      margin-bottom: 20px;
    }

    .header .date {
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
      display: inline-block;
      padding: 12px 30px;
      border-radius: 30px;
      font-weight: 600;
      border: 2px solid rgba(255,255,255,0.3);
    }

    .container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 40px;
    }

    .section {
      background: white;
      border-radius: 20px;
      padding: 50px;
      margin-bottom: 40px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .section-title {
      font-size: 2.5rem;
      color: #1f2937;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 4px solid #7c3aed;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .section-title .emoji {
      font-size: 3rem;
    }

    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
    .status-badge {
      display: inline-block;
      padding: 8px 20px;
      border-radius: 25px;
      font-size: 0.95rem;
      font-weight: 700;
      margin-left: 15px;
    }

    .status-done {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }

    .status-next {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
    }

    /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚«ãƒ¼ãƒ‰ï¼ˆ2ã‚«ãƒ©ãƒ ï¼‰ */
    .table-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 40px;
      margin: 40px 0;
    }

    .table-card {
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }

    .table-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }

    .table-card.implemented {
      border-color: #10b981;
    }

    .table-card.planned {
      border-color: #f59e0b;
    }

    .table-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px 30px;
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .table-card.implemented .table-header {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .table-card.planned .table-header {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .table-icon {
      font-size: 1.8rem;
      margin-right: 12px;
    }

    .table-body {
      padding: 0;
      max-height: 500px;
      overflow-y: auto;
    }

    .column-row {
      display: grid;
      grid-template-columns: 35% 20% 45%;
      padding: 16px 30px;
      border-bottom: 1px solid #e5e7eb;
      font-size: 1rem;
      transition: background 0.2s;
      gap: 15px;
      align-items: start;
    }

    .column-row:hover {
      background: #f9fafb;
    }

    .column-row:last-child {
      border-bottom: none;
    }

    .column-row.header {
      background: #f3f4f6;
      font-weight: 700;
      color: #374151;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .column-name {
      font-weight: 600;
      color: #1f2937;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.95rem;
      word-break: break-word;
    }

    .column-type {
      color: #6366f1;
      font-family: 'Monaco', 'Courier New', monospace;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .column-desc {
      color: #6b7280;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .pk-badge {
      background: #fbbf24;
      color: #78350f;
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 700;
      margin-left: 8px;
    }

    .fk-badge {
      background: #60a5fa;
      color: #1e3a8a;
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 700;
      margin-left: 8px;
    }

    /* ERå›³ã®çŸ¢å° */
    .er-arrow {
      text-align: center;
      padding: 30px;
      font-size: 1.3rem;
      font-weight: 700;
      color: #6b7280;
      position: relative;
    }

    .er-arrow::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(to bottom, #e5e7eb 0%, #9ca3af 50%, #e5e7eb 100%);
      transform: translateX(-50%);
    }

    .er-arrow-label {
      background: white;
      padding: 12px 30px;
      border: 3px solid #7c3aed;
      border-radius: 30px;
      display: inline-block;
      position: relative;
      z-index: 1;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    /* ã‚¤ãƒ³ãƒ•ã‚©ãƒœãƒƒã‚¯ã‚¹ */
    .info-box {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border: 3px solid #3b82f6;
      border-radius: 16px;
      padding: 30px;
      margin: 30px 0;
    }

    .info-box-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e3a8a;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .info-box-content {
      color: #1e40af;
      line-height: 1.9;
      font-size: 1.05rem;
    }

    .info-box-content strong {
      color: #1e3a8a;
    }

    /* SQLè¡¨ç¤º */
    .sql-block {
      background: #1f2937;
      color: #e5e7eb;
      padding: 30px;
      border-radius: 12px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.95rem;
      line-height: 1.9;
      overflow-x: auto;
      margin: 25px 0;
      border-left: 6px solid #7c3aed;
    }

    .sql-keyword {
      color: #fbbf24;
      font-weight: 700;
    }

    .sql-type {
      color: #60a5fa;
    }

    .sql-string {
      color: #10b981;
    }

    .sql-comment {
      color: #9ca3af;
      font-style: italic;
    }

    /* ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ */
    .flow-step {
      display: flex;
      align-items: flex-start;
      gap: 25px;
      padding: 30px;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border-radius: 16px;
      border-left: 6px solid #7c3aed;
      margin-bottom: 20px;
      transition: all 0.3s;
    }

    .flow-step:hover {
      transform: translateX(10px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }

    .flow-number {
      background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
      color: white;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: 700;
      flex-shrink: 0;
      box-shadow: 0 4px 16px rgba(124, 58, 237, 0.4);
    }

    .flow-content {
      flex: 1;
    }

    .flow-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 10px;
    }

    .flow-desc {
      color: #6b7280;
      line-height: 1.8;
      font-size: 1.05rem;
    }

    .flow-desc code {
      background: #e5e7eb;
      padding: 4px 12px;
      border-radius: 6px;
      font-family: 'Monaco', monospace;
      color: #1f2937;
      font-size: 0.95rem;
    }

    /* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ */
    .checklist-item {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 20px 30px;
      border-radius: 12px;
      margin-bottom: 15px;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .checklist-item:hover {
      transform: translateX(8px);
      border-color: #7c3aed;
    }

    .checklist-item.done {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
    }

    .checklist-item.todo {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    }

    .checkbox {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    }

    .checkbox.done {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }

    .checkbox.todo {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
    }

    .checklist-text {
      flex: 1;
      font-size: 1.15rem;
      color: #1f2937;
      font-weight: 500;
    }

    /* æ¯”è¼ƒè¡¨ */
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 30px 0;
      font-size: 1.05rem;
    }

    .comparison-table th {
      background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
      color: white;
      padding: 20px;
      text-align: left;
      font-weight: 700;
      font-size: 1.15rem;
    }

    .comparison-table td {
      padding: 20px;
      border-bottom: 2px solid #e5e7eb;
      vertical-align: top;
    }

    .comparison-table tr:hover {
      background: #f9fafb;
    }

    .comparison-table code {
      background: #e5e7eb;
      padding: 4px 12px;
      border-radius: 6px;
      font-family: 'Monaco', monospace;
      color: #1f2937;
      font-size: 0.95rem;
    }

    /* ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é † */
    .migration-step {
      background: #f9fafb;
      border-left: 6px solid #7c3aed;
      padding: 25px 30px;
      margin-bottom: 25px;
      border-radius: 10px;
      transition: all 0.3s;
    }

    .migration-step:hover {
      background: #f3f4f6;
      transform: translateX(5px);
    }

    .migration-step-number {
      background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.4rem;
      margin-right: 20px;
    }

    .migration-step-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
    }

    .migration-step-desc {
      color: #6b7280;
      line-height: 1.9;
      margin-left: 70px;
      font-size: 1.05rem;
    }

    .migration-step-desc strong {
      color: #1f2937;
    }

    .migration-step-desc code {
      background: #e5e7eb;
      padding: 3px 10px;
      border-radius: 6px;
      font-family: 'Monaco', monospace;
      color: #1f2937;
      font-size: 0.95rem;
    }

    /* ç›®æ¬¡ */
    .toc {
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border: 3px solid #e5e7eb;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 40px;
    }

    .toc-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toc-list {
      list-style: none;
    }

    .toc-list li {
      padding: 12px 0;
      border-bottom: 1px solid #e5e7eb;
      font-size: 1.1rem;
    }

    .toc-list li:last-child {
      border-bottom: none;
    }

    .toc-list a {
      color: #7c3aed;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
    }

    .toc-list a:hover {
      color: #5b21b6;
      padding-left: 10px;
    }

    @media (max-width: 1400px) {
      .table-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }

      .section {
        padding: 30px 20px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .column-row {
        grid-template-columns: 1fr;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ¬ çµµã‚³ãƒ³ãƒ†ã‚¢ãƒ—ãƒª ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆææ¡ˆ</h1>
    <p class="subtitle">å®Ÿè£…æ¸ˆã¿ + ã“ã‚Œã‹ã‚‰ä½œã‚‹å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå‹•ç”»ãƒ†ãƒ¼ãƒ–ãƒ«å«ã‚€å®Œå…¨ç‰ˆï¼‰</p>
    <div class="date">ğŸ“… 2026å¹´1æœˆ11æ—¥ç‰ˆ</div>
  </div>

  <div class="container">
    <!-- ç›®æ¬¡ -->
    <div class="toc">
      <div class="toc-title">ğŸ“‘ ç›®æ¬¡</div>
      <ul class="toc-list">
        <li><a href="#overview">1. å…¨ä½“æ§‹é€ ã¨ERå›³</a></li>
        <li><a href="#implemented">2. å®Ÿè£…æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«</a></li>
        <li><a href="#next-tables">3. ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ5ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰</a></li>
        <li><a href="#dataflow">4. ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ</a></li>
        <li><a href="#migration">5. å®Ÿè£…æ‰‹é †ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰</a></li>
        <li><a href="#security">6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ</a></li>
        <li><a href="#checklist">7. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</a></li>
      </ul>
    </div>

    <!-- 1. å…¨ä½“æ§‹é€  -->
    <div class="section" id="overview">
      <h2 class="section-title">
        <span class="emoji">ğŸ—ºï¸</span>
        1. å…¨ä½“æ§‹é€ ã¨ERå›³
      </h2>

      <div class="info-box">
        <div class="info-box-title">ğŸ’¡ è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ</div>
        <div class="info-box-content">
          <strong>éšå±¤æ§‹é€ :</strong> ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ ä¼ç”» â†’ ã‚·ãƒ¼ãƒ³ â†’ (ã‚»ãƒªãƒ• + ç”»åƒ + å‹•ç”») ã®4éšå±¤è¨­è¨ˆ<br>
          <strong>ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤:</strong> ä¸Šä½éšå±¤ã‚’å‰Šé™¤ã™ã‚‹ã¨ä¸‹ä½ã‚‚è‡ªå‹•å‰Šé™¤ï¼ˆãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’ä¿è¨¼ï¼‰<br>
          <strong>RLS:</strong> å„ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡Œãƒ¬ãƒ™ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è¨­å®šã—ã€è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½<br>
          <strong>ä¸€æ„åˆ¶ç´„:</strong> 1ã‚·ãƒ¼ãƒ³ã«æ¡ç”¨ç”»åƒã¯1ã¤ã¾ã§ï¼ˆUNIQUEåˆ¶ç´„ï¼‰<br>
          <strong>å‹•ç”»ç®¡ç†:</strong> ç”Ÿæˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆprocessing/completed/failedï¼‰ã‚’ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
        </div>
      </div>

      <!-- ERå›³: èªè¨¼å±¤ -->
      <div class="table-grid" style="grid-template-columns: 1fr; max-width: 800px; margin: 0 auto;">
        <div class="table-card implemented">
          <div class="table-header">
            <span><span class="table-icon">ğŸ”</span> auth.usersï¼ˆSupabaseæ¨™æº–ï¼‰</span>
            <span class="status-badge status-done">å®Ÿè£…æ¸ˆã¿</span>
          </div>
          <div class="table-body">
            <div class="column-row header">
              <div>ã‚«ãƒ©ãƒ å</div>
              <div>å‹</div>
              <div>èª¬æ˜</div>
            </div>
            <div class="column-row">
              <div class="column-name">id <span class="pk-badge">PK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆå…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®åŸºç›¤ï¼‰</div>
            </div>
            <div class="column-row">
              <div class="column-name">email</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆGoogle OAuthï¼‰</div>
            </div>
          </div>
        </div>
      </div>

      <div class="er-arrow">
        <span class="er-arrow-label">â†“ 1ãƒ¦ãƒ¼ã‚¶ãƒ¼ : è¤‡æ•°ä¼ç”» (1:N)</span>
      </div>

      <!-- ERå›³: ä¼ç”»å±¤ -->
      <div class="table-grid" style="grid-template-columns: 1fr; max-width: 800px; margin: 0 auto;">
        <div class="table-card planned">
          <div class="table-header">
            <span><span class="table-icon">ğŸ“‹</span> projectsï¼ˆä¼ç”»ç®¡ç†ï¼‰</span>
            <span class="status-badge status-next">æ¬¡ã®å®Ÿè£…</span>
          </div>
          <div class="table-body">
            <div class="column-row header">
              <div>ã‚«ãƒ©ãƒ å</div>
              <div>å‹</div>
              <div>èª¬æ˜</div>
            </div>
            <div class="column-row">
              <div class="column-name">id <span class="pk-badge">PK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">ä¼ç”»ID</div>
            </div>
            <div class="column-row">
              <div class="column-name">user_id <span class="fk-badge">FK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">ä½œæˆè€…IDï¼ˆauth.usersã¸ã®å¤–éƒ¨ã‚­ãƒ¼ï¼‰</div>
            </div>
            <div class="column-row">
              <div class="column-name">title</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">ä¼ç”»ã‚¿ã‚¤ãƒˆãƒ«</div>
            </div>
            <div class="column-row">
              <div class="column-name">channel_name</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">YouTubeãƒãƒ£ãƒ³ãƒãƒ«å</div>
            </div>
            <div class="column-row">
              <div class="column-name">goal</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">ç›®æ¨™ï¼ˆGPS - Goalï¼‰</div>
            </div>
            <div class="column-row">
              <div class="column-name">plan</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">è¨ˆç”»ï¼ˆGPS - Planï¼‰</div>
            </div>
            <div class="column-row">
              <div class="column-name">status</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">é€²æ—ï¼ˆGPS - Statusï¼‰</div>
            </div>
          </div>
        </div>
      </div>

      <div class="er-arrow">
        <span class="er-arrow-label">â†“ 1ä¼ç”» : è¤‡æ•°ã‚·ãƒ¼ãƒ³ (1:N)</span>
      </div>

      <!-- ERå›³: ã‚·ãƒ¼ãƒ³å±¤ -->
      <div class="table-grid" style="grid-template-columns: 1fr; max-width: 800px; margin: 0 auto;">
        <div class="table-card planned">
          <div class="table-header">
            <span><span class="table-icon">ğŸï¸</span> scenesï¼ˆã‚·ãƒ¼ãƒ³ç®¡ç†ï¼‰</span>
            <span class="status-badge status-next">æ¬¡ã®å®Ÿè£…</span>
          </div>
          <div class="table-body">
            <div class="column-row header">
              <div>ã‚«ãƒ©ãƒ å</div>
              <div>å‹</div>
              <div>èª¬æ˜</div>
            </div>
            <div class="column-row">
              <div class="column-name">id <span class="pk-badge">PK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">ã‚·ãƒ¼ãƒ³ID</div>
            </div>
            <div class="column-row">
              <div class="column-name">project_id <span class="fk-badge">FK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">æ‰€å±ä¼ç”»IDï¼ˆprojectsã¸ã®å¤–éƒ¨ã‚­ãƒ¼ï¼‰</div>
            </div>
            <div class="column-row">
              <div class="column-name">number</div>
              <div class="column-type">INTEGER</div>
              <div class="column-desc">ã‚·ãƒ¼ãƒ³ç•ªå·ï¼ˆ#1, #2, #3...ï¼‰</div>
            </div>
          </div>
        </div>
      </div>

      <div class="er-arrow">
        <span class="er-arrow-label">â†“ 1ã‚·ãƒ¼ãƒ³ : è¤‡æ•°ã‚»ãƒªãƒ•ãƒ»ç”»åƒãƒ»å‹•ç”» (1:N)</span>
      </div>

      <!-- ERå›³: ã‚»ãƒªãƒ•ãƒ»ç”»åƒãƒ»å‹•ç”»å±¤ -->
      <div class="table-grid">
        <div class="table-card planned">
          <div class="table-header">
            <span><span class="table-icon">ğŸ’¬</span> dialoguesï¼ˆã‚»ãƒªãƒ•ï¼‰</span>
            <span class="status-badge status-next">æ¬¡ã®å®Ÿè£…</span>
          </div>
          <div class="table-body">
            <div class="column-row header">
              <div>ã‚«ãƒ©ãƒ å</div>
              <div>å‹</div>
              <div>èª¬æ˜</div>
            </div>
            <div class="column-row">
              <div class="column-name">id <span class="pk-badge">PK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">ã‚»ãƒªãƒ•ID</div>
            </div>
            <div class="column-row">
              <div class="column-name">scene_id <span class="fk-badge">FK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">æ‰€å±ã‚·ãƒ¼ãƒ³ID</div>
            </div>
            <div class="column-row">
              <div class="column-name">speaker</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">è©±è€…åï¼ˆä¾‹: ãƒŠãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼‰</div>
            </div>
            <div class="column-row">
              <div class="column-name">text</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">ã‚»ãƒªãƒ•æœ¬æ–‡</div>
            </div>
            <div class="column-row">
              <div class="column-name">order_index</div>
              <div class="column-type">INTEGER</div>
              <div class="column-desc">ç™ºè©±é †åºï¼ˆ0, 1, 2...ï¼‰</div>
            </div>
          </div>
        </div>

        <div class="table-card planned">
          <div class="table-header">
            <span><span class="table-icon">ğŸ–¼ï¸</span> imagesï¼ˆç”»åƒå€™è£œï¼‰</span>
            <span class="status-badge status-next">æ¬¡ã®å®Ÿè£…</span>
          </div>
          <div class="table-body">
            <div class="column-row header">
              <div>ã‚«ãƒ©ãƒ å</div>
              <div>å‹</div>
              <div>èª¬æ˜</div>
            </div>
            <div class="column-row">
              <div class="column-name">id <span class="pk-badge">PK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">ç”»åƒID</div>
            </div>
            <div class="column-row">
              <div class="column-name">scene_id <span class="fk-badge">FK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">æ‰€å±ã‚·ãƒ¼ãƒ³ID</div>
            </div>
            <div class="column-row">
              <div class="column-name">prompt</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">Gemini APIç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
            </div>
            <div class="column-row">
              <div class="column-name">image_url</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">Supabase Storage URL</div>
            </div>
            <div class="column-row">
              <div class="column-name">selected</div>
              <div class="column-type">BOOLEAN</div>
              <div class="column-desc">æ¡ç”¨ãƒ•ãƒ©ã‚°ï¼ˆ1ã‚·ãƒ¼ãƒ³1ã¤ã¾ã§ï¼‰</div>
            </div>
          </div>
        </div>

        <div class="table-card planned">
          <div class="table-header">
            <span><span class="table-icon">ğŸ¥</span> videosï¼ˆå‹•ç”»ï¼‰</span>
            <span class="status-badge status-next">æ¬¡ã®å®Ÿè£…</span>
          </div>
          <div class="table-body">
            <div class="column-row header">
              <div>ã‚«ãƒ©ãƒ å</div>
              <div>å‹</div>
              <div>èª¬æ˜</div>
            </div>
            <div class="column-row">
              <div class="column-name">id <span class="pk-badge">PK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">å‹•ç”»ID</div>
            </div>
            <div class="column-row">
              <div class="column-name">scene_id <span class="fk-badge">FK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">æ‰€å±ã‚·ãƒ¼ãƒ³ID</div>
            </div>
            <div class="column-row">
              <div class="column-name">image_id <span class="fk-badge">FK</span></div>
              <div class="column-type">UUID</div>
              <div class="column-desc">å‚ç…§ç”»åƒIDï¼ˆimagesãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰</div>
            </div>
            <div class="column-row">
              <div class="column-name">prompt</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">Veo APIå‹•ç”»ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
            </div>
            <div class="column-row">
              <div class="column-name">video_url</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">Supabase Storage URL</div>
            </div>
            <div class="column-row">
              <div class="column-name">operation_name</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">Veo APIã®operation.nameï¼ˆãƒãƒ¼ãƒªãƒ³ã‚°ç”¨ï¼‰</div>
            </div>
            <div class="column-row">
              <div class="column-name">status</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆprocessing/completed/failedï¼‰</div>
            </div>
            <div class="column-row">
              <div class="column-name">model_type</div>
              <div class="column-type">TEXT</div>
              <div class="column-desc">ãƒ¢ãƒ‡ãƒ«ã‚¿ã‚¤ãƒ—ï¼ˆFast/Standardï¼‰</div>
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top: 60px; padding-top: 50px; border-top: 4px dashed #9ca3af;">
        <h3 style="text-align: center; color: #4b5563; margin-bottom: 30px; font-size: 1.8rem;">ğŸ”’ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡</h3>

        <div class="table-grid" style="grid-template-columns: 1fr; max-width: 800px; margin: 0 auto;">
          <div class="table-card implemented">
            <div class="table-header">
              <span><span class="table-icon">âœ…</span> allowed_emailsï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆï¼‰</span>
              <span class="status-badge status-done">å®Ÿè£…æ¸ˆã¿</span>
            </div>
            <div class="table-body">
              <div class="column-row header">
                <div>ã‚«ãƒ©ãƒ å</div>
                <div>å‹</div>
                <div>èª¬æ˜</div>
              </div>
              <div class="column-row">
                <div class="column-name">email <span class="pk-badge">PK</span></div>
                <div class="column-type">TEXT</div>
                <div class="column-desc">è¨±å¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</div>
              </div>
              <div class="column-row">
                <div class="column-name">name</div>
                <div class="column-type">TEXT</div>
                <div class="column-desc">ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆä»»æ„ï¼‰</div>
              </div>
              <div class="column-row">
                <div class="column-name">added_at</div>
                <div class="column-type">TIMESTAMPTZ</div>
                <div class="column-desc">ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆè¿½åŠ æ—¥æ™‚</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 2. å®Ÿè£…æ¸ˆã¿ -->
    <div class="section" id="implemented">
      <h2 class="section-title">
        <span class="emoji">âœ…</span>
        2. å®Ÿè£…æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«
      </h2>

      <div class="info-box">
        <div class="info-box-title">ğŸ“Œ ç¾çŠ¶ã‚µãƒãƒªãƒ¼</div>
        <div class="info-box-content">
          èªè¨¼åŸºç›¤ã¨APIé€£æºã¯å®Œæˆã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ãƒ¡ãƒ¢ãƒªç®¡ç†ï¼ˆJavaScriptå¤‰æ•°ï¼‰ã§å‹•ä½œä¸­ã€‚<br>
          æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®Ÿè£…ã—ã€æ°¸ç¶šåŒ–ã‚’å®Ÿç¾ã—ã¾ã™ã€‚
        </div>
      </div>

      <h3 style="font-size: 1.8rem; margin: 40px 0 25px; color: #1f2937;">âœ… allowed_emails ãƒ†ãƒ¼ãƒ–ãƒ«</h3>

      <div class="sql-block">
<span class="sql-keyword">CREATE TABLE</span> allowed_emails (
  email <span class="sql-type">TEXT</span> <span class="sql-keyword">PRIMARY KEY</span>,
  name <span class="sql-type">TEXT</span>,
  added_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW(),
  notes <span class="sql-type">TEXT</span>
);

<span class="sql-comment">-- RLSè¨­å®šï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰</span>
<span class="sql-keyword">ALTER TABLE</span> allowed_emails <span class="sql-keyword">ENABLE ROW LEVEL SECURITY</span>;

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Anyone can read allowed_emails"</span>
  <span class="sql-keyword">ON</span> allowed_emails
  <span class="sql-keyword">FOR SELECT</span>
  <span class="sql-keyword">USING</span> (<span class="sql-keyword">true</span>);
      </div>

      <h3 style="font-size: 1.8rem; margin: 40px 0 25px; color: #1f2937;">ğŸš€ Edge Functionsï¼ˆAPIé€£æºï¼‰</h3>

      <div class="table-grid">
        <div style="background: linear-gradient(135d, #f0f9ff 0%, #e0e7ff 100%); padding: 30px; border-radius: 16px; border: 3px solid #60a5fa;">
          <h4 style="font-size: 1.4rem; margin-bottom: 15px; color: #1e3a8a;">ğŸ–¼ï¸ generate-image</h4>
          <p style="color: #1e40af; line-height: 1.8; margin-bottom: 10px;">
            <strong>æ©Ÿèƒ½:</strong> Gemini 3 Pro Image APIã‚’ä½¿ç”¨ã—ãŸç”»åƒç”Ÿæˆ<br>
            <strong>å…¥åŠ›:</strong> <code>prompt</code> (ãƒ†ã‚­ã‚¹ãƒˆ)<br>
            <strong>å‡ºåŠ›:</strong> Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒãƒ‡ãƒ¼ã‚¿
          </p>
        </div>

        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 30px; border-radius: 16px; border: 3px solid #f59e0b;">
          <h4 style="font-size: 1.4rem; margin-bottom: 15px; color: #78350f;">ğŸ¥ generate-video</h4>
          <p style="color: #92400e; line-height: 1.8; margin-bottom: 10px;">
            <strong>æ©Ÿèƒ½:</strong> Google Veo 3.1ã‚’ä½¿ç”¨ã—ãŸå‹•ç”»ç”Ÿæˆ<br>
            <strong>å…¥åŠ›:</strong> <code>prompt</code>, <code>imageBase64</code>, <code>modelType</code><br>
            <strong>å‡ºåŠ›:</strong> operation.nameï¼ˆé•·æ™‚é–“å®Ÿè¡Œãƒˆãƒ¼ã‚¯ãƒ³ï¼‰
          </p>
        </div>

        <div style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); padding: 30px; border-radius: 16px; border: 3px solid #10b981;">
          <h4 style="font-size: 1.4rem; margin-bottom: 15px; color: #065f46;">ğŸ” check-video-status</h4>
          <p style="color: #047857; line-height: 1.8; margin-bottom: 10px;">
            <strong>æ©Ÿèƒ½:</strong> Veo 3.1ã®å‹•ç”»ç”Ÿæˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª<br>
            <strong>å…¥åŠ›:</strong> <code>operationName</code><br>
            <strong>å‡ºåŠ›:</strong> é€²æ—çŠ¶æ³ãƒ»å®Œäº†æ™‚ã¯å‹•ç”»ãƒ‡ãƒ¼ã‚¿
          </p>
        </div>
      </div>
    </div>

    <!-- 3. ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ« -->
    <div class="section" id="next-tables">
      <h2 class="section-title">
        <span class="emoji">ğŸš€</span>
        3. ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ5ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
      </h2>

      <div class="info-box">
        <div class="info-box-title">ğŸ¯ å®Ÿè£…å„ªå…ˆé †ä½</div>
        <div class="info-box-content">
          <strong>Step 1:</strong> projects ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆä¼ç”»ç®¡ç†ã®åŸºç›¤ï¼‰<br>
          <strong>Step 2:</strong> scenes ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚·ãƒ¼ãƒ³ç®¡ç†ï¼‰<br>
          <strong>Step 3:</strong> dialogues + images + videos ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆåŒæ™‚å®Ÿè£…å¯èƒ½ï¼‰<br>
          <strong>Step 4:</strong> Supabase Storageè¨­å®š + ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æº
        </div>
      </div>

      <h3 style="font-size: 2rem; margin: 50px 0 30px; color: #1f2937;">ğŸ“‹ projects ãƒ†ãƒ¼ãƒ–ãƒ«</h3>

      <div class="sql-block">
<span class="sql-keyword">CREATE TABLE</span> projects (
  id <span class="sql-type">UUID</span> <span class="sql-keyword">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  user_id <span class="sql-type">UUID</span> <span class="sql-keyword">REFERENCES</span> auth.users(id) <span class="sql-keyword">ON DELETE CASCADE</span>,
  title <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL DEFAULT</span> <span class="sql-string">'ç„¡é¡Œã®ä¼ç”»'</span>,
  channel_name <span class="sql-type">TEXT</span>,
  thumbnail_url <span class="sql-type">TEXT</span>,
  goal <span class="sql-type">TEXT</span>,              <span class="sql-comment">-- GPS ã® G (Goal)</span>
  plan <span class="sql-type">TEXT</span>,              <span class="sql-comment">-- GPS ã® P (Plan)</span>
  status <span class="sql-type">TEXT</span>,            <span class="sql-comment">-- GPS ã® S (Status)</span>
  created_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW(),
  updated_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW()
);

<span class="sql-comment">-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ</span>
<span class="sql-keyword">CREATE INDEX</span> idx_projects_user_id_created
  <span class="sql-keyword">ON</span> projects(user_id, created_at <span class="sql-keyword">DESC</span>);

<span class="sql-comment">-- RLSè¨­å®š</span>
<span class="sql-keyword">ALTER TABLE</span> projects <span class="sql-keyword">ENABLE ROW LEVEL SECURITY</span>;

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can CRUD their own projects"</span>
  <span class="sql-keyword">ON</span> projects
  <span class="sql-keyword">USING</span> (auth.uid() = user_id)
  <span class="sql-keyword">WITH CHECK</span> (auth.uid() = user_id);
      </div>

      <h3 style="font-size: 2rem; margin: 50px 0 30px; color: #1f2937;">ğŸï¸ scenes ãƒ†ãƒ¼ãƒ–ãƒ«</h3>

      <div class="sql-block">
<span class="sql-keyword">CREATE TABLE</span> scenes (
  id <span class="sql-type">UUID</span> <span class="sql-keyword">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  project_id <span class="sql-type">UUID</span> <span class="sql-keyword">REFERENCES</span> projects(id) <span class="sql-keyword">ON DELETE CASCADE</span>,
  number <span class="sql-type">INTEGER</span> <span class="sql-keyword">NOT NULL</span>,
  created_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW(),
  updated_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW(),
  <span class="sql-keyword">CONSTRAINT</span> unique_scene_number <span class="sql-keyword">UNIQUE</span> (project_id, number)
);

<span class="sql-comment">-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ</span>
<span class="sql-keyword">CREATE INDEX</span> idx_scenes_project_number
  <span class="sql-keyword">ON</span> scenes(project_id, number);

<span class="sql-comment">-- RLSè¨­å®š</span>
<span class="sql-keyword">ALTER TABLE</span> scenes <span class="sql-keyword">ENABLE ROW LEVEL SECURITY</span>;

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can CRUD scenes in their projects"</span>
  <span class="sql-keyword">ON</span> scenes
  <span class="sql-keyword">USING</span> (
    <span class="sql-keyword">EXISTS</span> (
      <span class="sql-keyword">SELECT</span> 1 <span class="sql-keyword">FROM</span> projects
      <span class="sql-keyword">WHERE</span> projects.id = scenes.project_id
      <span class="sql-keyword">AND</span> projects.user_id = auth.uid()
    )
  )
  <span class="sql-keyword">WITH CHECK</span> (
    <span class="sql-keyword">EXISTS</span> (
      <span class="sql-keyword">SELECT</span> 1 <span class="sql-keyword">FROM</span> projects
      <span class="sql-keyword">WHERE</span> projects.id = scenes.project_id
      <span class="sql-keyword">AND</span> projects.user_id = auth.uid()
    )
  );
      </div>

      <h3 style="font-size: 2rem; margin: 50px 0 30px; color: #1f2937;">ğŸ’¬ dialogues ãƒ†ãƒ¼ãƒ–ãƒ«</h3>

      <div class="sql-block">
<span class="sql-keyword">CREATE TABLE</span> dialogues (
  id <span class="sql-type">UUID</span> <span class="sql-keyword">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  scene_id <span class="sql-type">UUID</span> <span class="sql-keyword">REFERENCES</span> scenes(id) <span class="sql-keyword">ON DELETE CASCADE</span>,
  speaker <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL</span>,
  text <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL</span>,
  order_index <span class="sql-type">INTEGER</span> <span class="sql-keyword">NOT NULL</span>,
  created_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW(),
  updated_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW()
);

<span class="sql-comment">-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ</span>
<span class="sql-keyword">CREATE INDEX</span> idx_dialogues_scene_order
  <span class="sql-keyword">ON</span> dialogues(scene_id, order_index);

<span class="sql-comment">-- RLSè¨­å®š</span>
<span class="sql-keyword">ALTER TABLE</span> dialogues <span class="sql-keyword">ENABLE ROW LEVEL SECURITY</span>;

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can CRUD dialogues in their scenes"</span>
  <span class="sql-keyword">ON</span> dialogues
  <span class="sql-keyword">USING</span> (
    <span class="sql-keyword">EXISTS</span> (
      <span class="sql-keyword">SELECT</span> 1 <span class="sql-keyword">FROM</span> scenes
      <span class="sql-keyword">JOIN</span> projects <span class="sql-keyword">ON</span> projects.id = scenes.project_id
      <span class="sql-keyword">WHERE</span> scenes.id = dialogues.scene_id
      <span class="sql-keyword">AND</span> projects.user_id = auth.uid()
    )
  )
  <span class="sql-keyword">WITH CHECK</span> (
    <span class="sql-keyword">EXISTS</span> (
      <span class="sql-keyword">SELECT</span> 1 <span class="sql-keyword">FROM</span> scenes
      <span class="sql-keyword">JOIN</span> projects <span class="sql-keyword">ON</span> projects.id = scenes.project_id
      <span class="sql-keyword">WHERE</span> scenes.id = dialogues.scene_id
      <span class="sql-keyword">AND</span> projects.user_id = auth.uid()
    )
  );
      </div>

      <h3 style="font-size: 2rem; margin: 50px 0 30px; color: #1f2937;">ğŸ–¼ï¸ images ãƒ†ãƒ¼ãƒ–ãƒ«</h3>

      <div class="sql-block">
<span class="sql-keyword">CREATE TABLE</span> images (
  id <span class="sql-type">UUID</span> <span class="sql-keyword">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  scene_id <span class="sql-type">UUID</span> <span class="sql-keyword">REFERENCES</span> scenes(id) <span class="sql-keyword">ON DELETE CASCADE</span>,
  prompt <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL</span>,
  image_url <span class="sql-type">TEXT</span>,
  selected <span class="sql-type">BOOLEAN</span> <span class="sql-keyword">DEFAULT</span> <span class="sql-keyword">false</span>,
  created_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW(),
  <span class="sql-keyword">CONSTRAINT</span> one_selected_per_scene <span class="sql-keyword">UNIQUE</span> (scene_id, selected)
    <span class="sql-keyword">WHERE</span> (selected = <span class="sql-keyword">true</span>)
);

<span class="sql-comment">-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ</span>
<span class="sql-keyword">CREATE INDEX</span> idx_images_scene_id
  <span class="sql-keyword">ON</span> images(scene_id);

<span class="sql-keyword">CREATE INDEX</span> idx_images_created
  <span class="sql-keyword">ON</span> images(scene_id, created_at <span class="sql-keyword">DESC</span>);

<span class="sql-comment">-- RLSè¨­å®š</span>
<span class="sql-keyword">ALTER TABLE</span> images <span class="sql-keyword">ENABLE ROW LEVEL SECURITY</span>;

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can CRUD images in their scenes"</span>
  <span class="sql-keyword">ON</span> images
  <span class="sql-keyword">USING</span> (
    <span class="sql-keyword">EXISTS</span> (
      <span class="sql-keyword">SELECT</span> 1 <span class="sql-keyword">FROM</span> scenes
      <span class="sql-keyword">JOIN</span> projects <span class="sql-keyword">ON</span> projects.id = scenes.project_id
      <span class="sql-keyword">WHERE</span> scenes.id = images.scene_id
      <span class="sql-keyword">AND</span> projects.user_id = auth.uid()
    )
  )
  <span class="sql-keyword">WITH CHECK</span> (
    <span class="sql-keyword">EXISTS</span> (
      <span class="sql-keyword">SELECT</span> 1 <span class="sql-keyword">FROM</span> scenes
      <span class="sql-keyword">JOIN</span> projects <span class="sql-keyword">ON</span> projects.id = scenes.project_id
      <span class="sql-keyword">WHERE</span> scenes.id = images.scene_id
      <span class="sql-keyword">AND</span> projects.user_id = auth.uid()
    )
  );
      </div>

      <h3 style="font-size: 2rem; margin: 50px 0 30px; color: #1f2937;">ğŸ¥ videos ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆNEW!ï¼‰</h3>

      <div class="info-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-color: #f59e0b;">
        <div class="info-box-title" style="color: #78350f;">âš ï¸ é‡è¦ãªè¿½åŠ ãƒ†ãƒ¼ãƒ–ãƒ«</div>
        <div class="info-box-content" style="color: #92400e;">
          <strong>ç†ç”±:</strong> Veo 3.1ã§ç”Ÿæˆã—ãŸå‹•ç”»ã‚’ä¿å­˜ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå¿…è¦<br>
          <strong>æ©Ÿèƒ½:</strong> ç”Ÿæˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ï¼ˆprocessing/completed/failedï¼‰<br>
          <strong>ãƒãƒ¼ãƒªãƒ³ã‚°:</strong> operation_nameã‚’ä½¿ã£ã¦é•·æ™‚é–“å®Ÿè¡Œå‡¦ç†ã‚’è¿½è·¡<br>
          <strong>å‚ç…§ç”»åƒ:</strong> image_idã§ã©ã®ç”»åƒã‹ã‚‰å‹•ç”»ã‚’ç”Ÿæˆã—ãŸã‹è¨˜éŒ²
        </div>
      </div>

      <div class="sql-block">
<span class="sql-keyword">CREATE TABLE</span> videos (
  id <span class="sql-type">UUID</span> <span class="sql-keyword">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  scene_id <span class="sql-type">UUID</span> <span class="sql-keyword">REFERENCES</span> scenes(id) <span class="sql-keyword">ON DELETE CASCADE</span>,
  image_id <span class="sql-type">UUID</span> <span class="sql-keyword">REFERENCES</span> images(id) <span class="sql-keyword">ON DELETE SET NULL</span>,
  prompt <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL</span>,
  video_url <span class="sql-type">TEXT</span>,
  operation_name <span class="sql-type">TEXT</span>,         <span class="sql-comment">-- Veo API ã® operation.nameï¼ˆãƒãƒ¼ãƒªãƒ³ã‚°ç”¨ï¼‰</span>
  status <span class="sql-type">TEXT</span> <span class="sql-keyword">DEFAULT</span> <span class="sql-string">'processing'</span>,  <span class="sql-comment">-- processing, completed, failed</span>
  model_type <span class="sql-type">TEXT</span>,             <span class="sql-comment">-- Fast or Standard</span>
  created_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW(),
  completed_at <span class="sql-type">TIMESTAMPTZ</span>
);

<span class="sql-comment">-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ</span>
<span class="sql-keyword">CREATE INDEX</span> idx_videos_scene_id
  <span class="sql-keyword">ON</span> videos(scene_id);

<span class="sql-keyword">CREATE INDEX</span> idx_videos_status
  <span class="sql-keyword">ON</span> videos(status, created_at <span class="sql-keyword">DESC</span>);

<span class="sql-keyword">CREATE INDEX</span> idx_videos_operation_name
  <span class="sql-keyword">ON</span> videos(operation_name);

<span class="sql-comment">-- RLSè¨­å®š</span>
<span class="sql-keyword">ALTER TABLE</span> videos <span class="sql-keyword">ENABLE ROW LEVEL SECURITY</span>;

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can CRUD videos in their scenes"</span>
  <span class="sql-keyword">ON</span> videos
  <span class="sql-keyword">USING</span> (
    <span class="sql-keyword">EXISTS</span> (
      <span class="sql-keyword">SELECT</span> 1 <span class="sql-keyword">FROM</span> scenes
      <span class="sql-keyword">JOIN</span> projects <span class="sql-keyword">ON</span> projects.id = scenes.project_id
      <span class="sql-keyword">WHERE</span> scenes.id = videos.scene_id
      <span class="sql-keyword">AND</span> projects.user_id = auth.uid()
    )
  )
  <span class="sql-keyword">WITH CHECK</span> (
    <span class="sql-keyword">EXISTS</span> (
      <span class="sql-keyword">SELECT</span> 1 <span class="sql-keyword">FROM</span> scenes
      <span class="sql-keyword">JOIN</span> projects <span class="sql-keyword">ON</span> projects.id = scenes.project_id
      <span class="sql-keyword">WHERE</span> scenes.id = videos.scene_id
      <span class="sql-keyword">AND</span> projects.user_id = auth.uid()
    )
  );
      </div>

      <h3 style="font-size: 2rem; margin: 50px 0 30px; color: #1f2937;">ğŸ“¦ Supabase Storage ãƒã‚±ãƒƒãƒˆ</h3>

      <div class="sql-block">
<span class="sql-comment">-- Storageãƒã‚±ãƒƒãƒˆä½œæˆï¼ˆç®¡ç†ç”»é¢ or SQLï¼‰</span>
<span class="sql-keyword">INSERT INTO</span> storage.buckets (id, name, public)
<span class="sql-keyword">VALUES</span>
  (<span class="sql-string">'storyboard-images'</span>, <span class="sql-string">'storyboard-images'</span>, <span class="sql-keyword">false</span>),
  (<span class="sql-string">'storyboard-videos'</span>, <span class="sql-string">'storyboard-videos'</span>, <span class="sql-keyword">false</span>);

<span class="sql-comment">-- ç”»åƒãƒã‚±ãƒƒãƒˆã®RLSãƒãƒªã‚·ãƒ¼</span>
<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can upload images"</span>
  <span class="sql-keyword">ON</span> storage.objects <span class="sql-keyword">FOR INSERT</span>
  <span class="sql-keyword">WITH CHECK</span> (
    bucket_id = <span class="sql-string">'storyboard-images'</span> <span class="sql-keyword">AND</span>
    auth.uid()::<span class="sql-type">text</span> = (storage.foldername(name))[1]
  );

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can read their own images"</span>
  <span class="sql-keyword">ON</span> storage.objects <span class="sql-keyword">FOR SELECT</span>
  <span class="sql-keyword">USING</span> (
    bucket_id = <span class="sql-string">'storyboard-images'</span> <span class="sql-keyword">AND</span>
    auth.uid()::<span class="sql-type">text</span> = (storage.foldername(name))[1]
  );

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can delete their own images"</span>
  <span class="sql-keyword">ON</span> storage.objects <span class="sql-keyword">FOR DELETE</span>
  <span class="sql-keyword">USING</span> (
    bucket_id = <span class="sql-string">'storyboard-images'</span> <span class="sql-keyword">AND</span>
    auth.uid()::<span class="sql-type">text</span> = (storage.foldername(name))[1]
  );

<span class="sql-comment">-- å‹•ç”»ãƒã‚±ãƒƒãƒˆã®RLSãƒãƒªã‚·ãƒ¼ï¼ˆåŒæ§˜ï¼‰</span>
<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can upload videos"</span>
  <span class="sql-keyword">ON</span> storage.objects <span class="sql-keyword">FOR INSERT</span>
  <span class="sql-keyword">WITH CHECK</span> (
    bucket_id = <span class="sql-string">'storyboard-videos'</span> <span class="sql-keyword">AND</span>
    auth.uid()::<span class="sql-type">text</span> = (storage.foldername(name))[1]
  );

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can read their own videos"</span>
  <span class="sql-keyword">ON</span> storage.objects <span class="sql-keyword">FOR SELECT</span>
  <span class="sql-keyword">USING</span> (
    bucket_id = <span class="sql-string">'storyboard-videos'</span> <span class="sql-keyword">AND</span>
    auth.uid()::<span class="sql-type">text</span> = (storage.foldername(name))[1]
  );

<span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can delete their own videos"</span>
  <span class="sql-keyword">ON</span> storage.objects <span class="sql-keyword">FOR DELETE</span>
  <span class="sql-keyword">USING</span> (
    bucket_id = <span class="sql-string">'storyboard-videos'</span> <span class="sql-keyword">AND</span>
    auth.uid()::<span class="sql-type">text</span> = (storage.foldername(name))[1]
  );
      </div>
    </div>

    <!-- 4. ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ -->
    <div class="section" id="dataflow">
      <h2 class="section-title">
        <span class="emoji">ğŸ”„</span>
        4. ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ
      </h2>

      <div class="flow-step">
        <div class="flow-number">1</div>
        <div class="flow-content">
          <div class="flow-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³</div>
          <div class="flow-desc">
            Google OAuth â†’ Supabase Auth â†’ <code>auth.users</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã«è‡ªå‹•ä¿å­˜
          </div>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-number">2</div>
        <div class="flow-content">
          <div class="flow-title">ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆç¢ºèª</div>
          <div class="flow-desc">
            <code>allowed_emails</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã§ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç…§åˆã€‚æœªç™»éŒ²ãªã‚‰è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
          </div>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-number">3</div>
        <div class="flow-content">
          <div class="flow-title">ä¼ç”»ä½œæˆ</div>
          <div class="flow-desc">
            <code>projects</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ–°è¦ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆã€‚user_idã§ç´ä»˜ã‘ã€GPSè¨­è¨ˆï¼ˆGoal/Plan/Statusï¼‰ã‚’è¨˜éŒ²
          </div>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-number">4</div>
        <div class="flow-content">
          <div class="flow-title">ã‚·ãƒ¼ãƒ³è¿½åŠ </div>
          <div class="flow-desc">
            <code>scenes</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ ã€‚project_idã§ä¼ç”»ã¨ç´ä»˜ã‘ã€ã‚·ãƒ¼ãƒ³ç•ªå·ï¼ˆ#1, #2...ï¼‰ã‚’è¨­å®š
          </div>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-number">5</div>
        <div class="flow-content">
          <div class="flow-title">ã‚»ãƒªãƒ•å…¥åŠ›</div>
          <div class="flow-desc">
            <code>dialogues</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã€‚scene_idã§ç´ä»˜ã‘ã€order_indexã§ç™ºè©±é †åºã‚’ç®¡ç†
          </div>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-number">6</div>
        <div class="flow-content">
          <div class="flow-title">ç”»åƒç”Ÿæˆ</div>
          <div class="flow-desc">
            Edge Function (generate-image) â†’ Gemini API â†’ Base64ç”»åƒå–å¾— â†’ Supabase Storage (storyboard-images) ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
          </div>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-number">7</div>
        <div class="flow-content">
          <div class="flow-title">ç”»åƒä¿å­˜</div>
          <div class="flow-desc">
            Storage URLã‚’å–å¾— â†’ <code>images</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ï¼ˆprompt, image_url, selectedï¼‰
          </div>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-number">8</div>
        <div class="flow-content">
          <div class="flow-title">å‹•ç”»ç”Ÿæˆé–‹å§‹</div>
          <div class="flow-desc">
            Edge Function (generate-video) â†’ Veo 3.1 API â†’ operation.nameå–å¾— â†’ <code>videos</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ï¼ˆstatus='processing'ï¼‰
          </div>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-number">9</div>
        <div class="flow-content">
          <div class="flow-title">å‹•ç”»ç”Ÿæˆãƒãƒ¼ãƒªãƒ³ã‚°</div>
          <div class="flow-desc">
            Edge Function (check-video-status) â†’ operation.nameã§é€²æ—ç¢ºèª â†’ å®Œäº†æ™‚ã«video_urlæ›´æ–° â†’ status='completed'ã«å¤‰æ›´
          </div>
        </div>
      </div>

      <div class="flow-step">
        <div class="flow-number">10</div>
        <div class="flow-content">
          <div class="flow-title">å‹•ç”»ä¿å­˜</div>
          <div class="flow-desc">
            Veo APIã‹ã‚‰å‹•ç”»ãƒ‡ãƒ¼ã‚¿å–å¾— â†’ Supabase Storage (storyboard-videos) ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ <code>videos</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã®video_urlæ›´æ–°
          </div>
        </div>
      </div>
    </div>

    <!-- 5. å®Ÿè£…æ‰‹é † -->
    <div class="section" id="migration">
      <h2 class="section-title">
        <span class="emoji">ğŸ“</span>
        5. å®Ÿè£…æ‰‹é †ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
      </h2>

      <div class="info-box">
        <div class="info-box-title">ğŸ¯ æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</div>
        <div class="info-box-content">
          Supabaseãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é †ç•ªã«ä½œæˆã—ã€æ®µéšçš„ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚<br>
          å„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯ <code>supabase/migrations/</code> ã«é…ç½®ã—ã¾ã™ã€‚
        </div>
      </div>

      <div class="migration-step">
        <div class="migration-step-title">
          <span class="migration-step-number">1</span>
          projects ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
        </div>
        <div class="migration-step-desc">
          <strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> <code>20260111000001_create_projects.sql</code><br>
          <strong>å†…å®¹:</strong> projects ãƒ†ãƒ¼ãƒ–ãƒ« + ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ + RLSãƒãƒªã‚·ãƒ¼<br>
          <strong>å®Ÿè¡Œ:</strong> <code>supabase db push</code> ã¾ãŸã¯ Supabase Dashboard
        </div>
      </div>

      <div class="migration-step">
        <div class="migration-step-title">
          <span class="migration-step-number">2</span>
          scenes ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
        </div>
        <div class="migration-step-desc">
          <strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> <code>20260111000002_create_scenes.sql</code><br>
          <strong>å†…å®¹:</strong> scenes ãƒ†ãƒ¼ãƒ–ãƒ« + ä¸€æ„åˆ¶ç´„ + ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ + RLSãƒãƒªã‚·ãƒ¼<br>
          <strong>ä¾å­˜:</strong> projects ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå¿…é ˆï¼ˆå¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ï¼‰
        </div>
      </div>

      <div class="migration-step">
        <div class="migration-step-title">
          <span class="migration-step-number">3</span>
          dialogues ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
        </div>
        <div class="migration-step-desc">
          <strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> <code>20260111000003_create_dialogues.sql</code><br>
          <strong>å†…å®¹:</strong> dialogues ãƒ†ãƒ¼ãƒ–ãƒ« + ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ + RLSãƒãƒªã‚·ãƒ¼<br>
          <strong>ä¾å­˜:</strong> scenes ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå¿…é ˆ
        </div>
      </div>

      <div class="migration-step">
        <div class="migration-step-title">
          <span class="migration-step-number">4</span>
          images ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
        </div>
        <div class="migration-step-desc">
          <strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> <code>20260111000004_create_images.sql</code><br>
          <strong>å†…å®¹:</strong> images ãƒ†ãƒ¼ãƒ–ãƒ« + ä¸€æ„åˆ¶ç´„ + ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ + RLSãƒãƒªã‚·ãƒ¼<br>
          <strong>ä¾å­˜:</strong> scenes ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå¿…é ˆ
        </div>
      </div>

      <div class="migration-step">
        <div class="migration-step-title">
          <span class="migration-step-number">5</span>
          videos ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆNEW!ï¼‰
        </div>
        <div class="migration-step-desc">
          <strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> <code>20260111000005_create_videos.sql</code><br>
          <strong>å†…å®¹:</strong> videos ãƒ†ãƒ¼ãƒ–ãƒ« + ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ + RLSãƒãƒªã‚·ãƒ¼<br>
          <strong>ä¾å­˜:</strong> scenes, images ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå¿…é ˆ
        </div>
      </div>

      <div class="migration-step">
        <div class="migration-step-title">
          <span class="migration-step-number">6</span>
          Storage ãƒã‚±ãƒƒãƒˆè¨­å®š
        </div>
        <div class="migration-step-desc">
          <strong>æ–¹æ³•1:</strong> Supabase Dashboard â†’ Storage â†’ New Bucket<br>
          <strong>æ–¹æ³•2:</strong> SQL (<code>INSERT INTO storage.buckets</code>)<br>
          <strong>è¨­å®š:</strong> 2ã¤ã®ãƒã‚±ãƒƒãƒˆä½œæˆï¼ˆ<code>storyboard-images</code>, <code>storyboard-videos</code>ï¼‰
        </div>
      </div>

      <div class="migration-step">
        <div class="migration-step-title">
          <span class="migration-step-number">7</span>
          Storage RLSãƒãƒªã‚·ãƒ¼è¨­å®š
        </div>
        <div class="migration-step-desc">
          <strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> <code>20260111000006_create_storage_policies.sql</code><br>
          <strong>å†…å®¹:</strong> å„ãƒã‚±ãƒƒãƒˆã®INSERT/SELECT/DELETE ãƒãƒªã‚·ãƒ¼ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ™ãƒ¼ã‚¹ï¼‰
        </div>
      </div>

      <div class="migration-step">
        <div class="migration-step-title">
          <span class="migration-step-number">8</span>
          ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºå®Ÿè£…
        </div>
        <div class="migration-step-desc">
          <strong>å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:</strong> <code>storyboard.html</code>, <code>projects.html</code><br>
          <strong>å¤‰æ›´å†…å®¹:</strong> ãƒ¡ãƒ¢ãƒªç®¡ç† â†’ Supabaseã‚¯ã‚¨ãƒªã«ç½®ãæ›ãˆ<br>
          <strong>æ©Ÿèƒ½:</strong> CRUDæ“ä½œã€ç”»åƒãƒ»å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã€ãƒãƒ¼ãƒªãƒ³ã‚°å‡¦ç†
        </div>
      </div>

      <div class="migration-step">
        <div class="migration-step-title">
          <span class="migration-step-number">9</span>
          ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼
        </div>
        <div class="migration-step-desc">
          <strong>ç¢ºèªé …ç›®:</strong> RLSãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ã€ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ãŒæ©Ÿèƒ½ã™ã‚‹ã‹<br>
          <strong>ãƒ†ã‚¹ãƒˆ:</strong> è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å‹•ä½œç¢ºèªã€æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„ã‹æ¤œè¨¼ã€å‹•ç”»ç”Ÿæˆãƒãƒ¼ãƒªãƒ³ã‚°ã®å‹•ä½œç¢ºèª
        </div>
      </div>
    </div>

    <!-- 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ -->
    <div class="section" id="security">
      <h2 class="section-title">
        <span class="emoji">ğŸ”’</span>
        6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ
      </h2>

      <h3 style="font-size: 1.8rem; margin: 30px 0 25px; color: #1f2937;">ğŸ” RLSãƒãƒªã‚·ãƒ¼ã®ä»•çµ„ã¿</h3>

      <table class="comparison-table">
        <thead>
          <tr>
            <th>ãƒ†ãƒ¼ãƒ–ãƒ«</th>
            <th>ãƒãƒªã‚·ãƒ¼å†…å®¹</th>
            <th>åŠ¹æœ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>projects</code></td>
            <td><code>auth.uid() = user_id</code></td>
            <td>è‡ªåˆ†ãŒä½œæˆã—ãŸä¼ç”»ã®ã¿æ“ä½œå¯èƒ½</td>
          </tr>
          <tr>
            <td><code>scenes</code></td>
            <td><code>EXISTS (SELECT 1 FROM projects WHERE ...)</code></td>
            <td>è‡ªåˆ†ã®ä¼ç”»ã®ã‚·ãƒ¼ãƒ³ã®ã¿æ“ä½œå¯èƒ½</td>
          </tr>
          <tr>
            <td><code>dialogues</code></td>
            <td><code>EXISTS (SELECT 1 FROM scenes JOIN projects WHERE ...)</code></td>
            <td>è‡ªåˆ†ã®ä¼ç”»ã®ã‚·ãƒ¼ãƒ³ã®ã‚»ãƒªãƒ•ã®ã¿æ“ä½œå¯èƒ½</td>
          </tr>
          <tr>
            <td><code>images</code></td>
            <td><code>EXISTS (SELECT 1 FROM scenes JOIN projects WHERE ...)</code></td>
            <td>è‡ªåˆ†ã®ä¼ç”»ã®ã‚·ãƒ¼ãƒ³ã®ç”»åƒã®ã¿æ“ä½œå¯èƒ½</td>
          </tr>
          <tr>
            <td><code>videos</code></td>
            <td><code>EXISTS (SELECT 1 FROM scenes JOIN projects WHERE ...)</code></td>
            <td>è‡ªåˆ†ã®ä¼ç”»ã®ã‚·ãƒ¼ãƒ³ã®å‹•ç”»ã®ã¿æ“ä½œå¯èƒ½</td>
          </tr>
        </tbody>
      </table>

      <div class="info-box" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border-color: #10b981;">
        <div class="info-box-title" style="color: #065f46;">ğŸ’¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒã‚¤ãƒ³ãƒˆ</div>
        <div class="info-box-content" style="color: #047857;">
          <strong>å¤šå±¤é˜²å¾¡:</strong> èªè¨¼ â†’ ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ â†’ RLS ã®3æ®µéšã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡<br>
          <strong>æœ€å°æ¨©é™:</strong> å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å¿…è¦æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½<br>
          <strong>é€éçš„:</strong> ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã›ãšã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–<br>
          <strong>ç›£æŸ»å¯èƒ½:</strong> RLSãƒãƒªã‚·ãƒ¼ã¯SQLã§æ˜ç¤ºçš„ã«è¨˜è¿°ã•ã‚Œã€ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯èƒ½<br>
          <strong>API Keyä¿è­·:</strong> Edge Functionã§Gemini/Veo APIã‚­ãƒ¼ã‚’éš è”½
        </div>
      </div>
    </div>

    <!-- 7. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ -->
    <div class="section" id="checklist">
      <h2 class="section-title">
        <span class="emoji">âœ“</span>
        7. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
      </h2>

      <div class="checklist-item done">
        <div class="checkbox done">âœ“</div>
        <div class="checklist-text">allowed_emails ãƒ†ãƒ¼ãƒ–ãƒ« + RLSãƒãƒªã‚·ãƒ¼</div>
      </div>

      <div class="checklist-item done">
        <div class="checkbox done">âœ“</div>
        <div class="checklist-text">Google OAuthèªè¨¼ã®å®Ÿè£…</div>
      </div>

      <div class="checklist-item done">
        <div class="checkbox done">âœ“</div>
        <div class="checklist-text">Edge Functionï¼ˆGeminiãƒ»Veo APIé€£æºï¼‰</div>
      </div>

      <div class="checklist-item done">
        <div class="checkbox done">âœ“</div>
        <div class="checklist-text">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ¢ãƒƒã‚¯UIä½œæˆ</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">projects ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ + RLSãƒãƒªã‚·ãƒ¼</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">scenes ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ + ä¸€æ„åˆ¶ç´„ + RLSãƒãƒªã‚·ãƒ¼</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">dialogues ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ + RLSãƒãƒªã‚·ãƒ¼</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">images ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ + ä¸€æ„åˆ¶ç´„ + RLSãƒãƒªã‚·ãƒ¼</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">videos ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ + ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ + RLSãƒãƒªã‚·ãƒ¼ï¼ˆNEW!ï¼‰</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">Supabase Storage ãƒã‚±ãƒƒãƒˆä½œæˆï¼ˆstoryboard-images, storyboard-videosï¼‰</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">Storage RLSãƒãƒªã‚·ãƒ¼è¨­å®šï¼ˆç”»åƒãƒ»å‹•ç”»ãƒã‚±ãƒƒãƒˆï¼‰</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ â† â†’ Supabaseé€£æºå®Ÿè£…ï¼ˆCRUDæ“ä½œï¼‰</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">ç”»åƒã®Base64 â†’ Storageä¿å­˜å‡¦ç†</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">å‹•ç”»ç”Ÿæˆã®ãƒãƒ¼ãƒªãƒ³ã‚°å‡¦ç† + ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°</div>
      </div>

      <div class="checklist-item todo">
        <div class="checkbox todo">â—‹</div>
        <div class="checklist-text">è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼</div>
      </div>
    </div>

  </div>
</body>
</html>